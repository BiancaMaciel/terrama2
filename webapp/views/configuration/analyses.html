{% extends "../base/layout.html" %}

{% set tabActive = "analyses" %}

{% block ngApp %} ng-app="terrama2.analyses" {% endblock %}

{% block title %} TerraMA2 {[ __('Analyses') ]} {% endblock %}

{% block javascripts %}

<script src="/externals/angular/angular.min.js"></script>
<script src="/externals/angular/i18n-angular.min.js"></script>
<script src="/javascripts/angular/app.js"></script>
<script src="/javascripts/angular/services.js"></script>
<script src="/javascripts/angular/table/table.js"></script>

<script>

  angular.module('terrama2.analyses', ['terrama2', 'terrama2.services', 'terrama2.table'])
    .controller("ListController", ['$scope', '$http', 'AnalysisFactory', function($scope, $http, AnalysisFactory) {
      $scope.model = [];

      $scope.iconProperties = {
        type: "img"
      };

      $scope.fields = [
        {key: "name", as: "Name"},
        {key: "type", as: "Type"}
      ];

      $scope.linkToAdd = "/configuration/analyses/new";

      $scope.link = function(object) {
        return "/configuration/analyses/new";
      };

      $scope.remove = function(object) {
        return "/api/Analysis/" + object.id + "/delete";
      };

      $scope.icon = function(object) {
        switch(object.type) {
          case "Monitored Object":
            return "/images/monitored-object.png";
            break;
          case "Grid":
            return "/images/grid-small.png";
            break;
          default:
            return "/images/map-pin.png";
        }
      }

      AnalysisFactory.get().success(function(analysis) {
        $scope.model = analysis;
      }).error(function(err) {
        console.log("Err in retrieving Analysis " + err);
      }).finally(function() {
        $scope.loading = false;
      });
    }]);
</script>

{% endblock %}

{% block content %}

<div class="col-md-12" ng-controller="ListController">
  <div class="col-md-12">
    <div class="box">
      <div class="box-header with-border">
        <h3 class="box-title">{[ __('Analyses') ]}</h3>
      </div><!-- /.box-header -->

      <div class="box-body">
        <terrama2-table fields="fields" model="model" link="link" icon="icon" icon-properties="iconProperties" link-to-add="linkToAdd" context="'analysis'" remove="remove(object);"></terrama2-table>
      </div><!-- /.box-body -->

    </div><!-- /.box -->
  </div> <!-- end col md 6 -->

</div> <!-- end col md 12 -->

{% endblock %}
